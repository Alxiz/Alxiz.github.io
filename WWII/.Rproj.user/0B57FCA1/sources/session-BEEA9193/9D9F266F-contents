#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# Find out more about building applications with Shiny here:
#
#    http://shiny.rstudio.com/
#

library(readr)
library(shiny)
library(ggplot2)
library(dplyr)
library(plotly)

casualty_data <- read_csv("ww2_dataset.csv")

ui <- fluidPage(
  titlePanel("WW2 Casualties by Country"),
  mainPanel(
    plotlyOutput("piechart")
  )
)

server <- function(input, output) {
  # Check if the "Country" column exists in the dataset
  if ("Country" %in% colnames(casualty_data)) {
    # Convert the "Totaldeaths" column to numeric
    casualty_data$Totaldeaths <- as.numeric(casualty_data$Totaldeaths)
    
    # Define a vector of important countries
    important_countries <- c("USA", "Germany", "Japan", "United Kingdom", "Soviet Union", "Italy", "France", "China", "Poland")
    
    # Filter the data to include only the important countries
    filtered_data <- filter(casualty_data, Country %in% important_countries)
    
    output$piechart <- renderPlotly({
      # Calculate the total casualties for the filtered countries
      total_casualties <- sum(filtered_data$Totaldeaths)
      
      # Calculate the percentage of casualties for each country
      percentages <- filtered_data %>%
        group_by(Country) %>%
        summarize(Percentage = sum(Totaldeaths) / total_casualties)
      
      # Create an interactive pie chart using plotly
      pie_chart <- ggplot(data = percentages, aes(x = "", y = Percentage, fill = Country)) +
        geom_bar(stat = "identity", width = 1) +
        coord_polar(theta = "y") +
        labs(fill = "Country") +
        ggtitle("WW2 Casualties by Country (Percentage)")
      
      # Convert the ggplot to a plotly object for interactivity
      plotly::ggplotly(pie_chart)
    })
  } else {
    # If the "Country" column doesn't exist, display an error message
    output$piechart <- renderText("The 'Country' column does not exist in the dataset.")
  }
}

# Run the application
shinyApp(ui = ui, server = server)